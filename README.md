# Практическая работа 2

## Этап 1: Минимальный прототип с конфигурацией

### Цель
Создать CLI-приложение с настройкой параметров через командную строку.

### Выполненные задачи
- Реализован парсинг аргументов командной строки
- Добавлена валидация обязательных параметров
- Реализован вывод параметров в формате "ключ-значение"
- Добавлена обработка ошибок для всех параметров

### Использование
```bash
cd stage1
python stage1.py --package <name> --repo <url> --test-mode <true/false> [options]
```
### Пример
```bash
python stage1.py --package react --repo https://registry.npmjs.org --test-mode false --version 18.2.0 --output deps.png --ascii-tree true --max-depth 5
```

## Этап 2: Сбор данных
### Цель
Реализовать сбор информации о зависимостях пакетов из npm registry.

### Выполненные задачи
- Реализовано получение данных через NPM Registry API
- Добавлено извлечение прямых зависимостей для указанной версии пакета
- Реализована обработка ошибок сети и парсинга JSON
- Запрещено использование менеджеров пакетов и сторонних библиотек

### Использование
```bash
cd stage2
python stage2.py --package <name> --repo <url> --test-mode false --version <version>
```

### Пример
```bash
python stage2.py --package react --repo https://registry.npmjs.org --test-mode false --version 18.2.0
```

## Этап 3: Построение графа зависимостей
### Цель
Построить граф зависимостей с учетом транзитивности и выполнить основные операции над ним.

### Выполненные задачи
- Построение графа зависимостей с использованием DFS
- Учёт максимальной глубины анализа, задаваемой пользователем.
- Обнаружение и корректная обработка циклических зависимостей.
- Добавлен тестовый режим, позволяющий строить граф по файлу формата:
```
A: B C
B: C
C:
```
- Реализован вывод зависимостей в виде ASCII-дерева.
- Добавлена топологическая сортировка для определения порядка установки пакетов.

### Использование
```bash
cd stage3
# Тестовый режим
python stage3.py --package A --repo test_simple.txt --test-mode true --ascii-tree true --max-depth 3

# Реальный режим  
python stage3.py --package react --repo https://registry.npmjs.org --test-mode false --version 18.2.0 --ascii-tree true --max-depth 2
```

### Тестовые файлы

- test_simple.txt - простой граф зависимостей

- test_cycle.txt - граф с циклическими зависимостями

- test_complex.txt - сложный граф зависимостей


## Этап 4 — Дополнительные операции над графом зависимостей
### Цель
Реализовать дополнительные операции над построенным графом зависимостей, включая определение порядка загрузки зависимостей и сравнение результатов с реальным менеджером пакетов npm.

### Выполненные задачи
1. Определение порядка загрузки зависимостей

- Реализован алгоритм обхода графа в стиле npm (пост-обход DFS):

- каждая зависимость загружается раньше пакета, который её требует

- результат выводится при использовании флага --load-order

2. Топологическая сортировка

- Добавлен алгоритм Кана для получения корректного порядка узлов при отсутствии циклов.

- выводится автоматически после построения графа


3. Поддержка ASCII-дерева

При флаге --ascii выводится древовидная структура зависимостей.

4. Режим тестирования

В test-режиме граф читается из файла, где каждая строка имеет вид:

A: B C
B: D
C:
...


Поддерживаются сложные графы, а также циклы.

5. Сравнение с реальным менеджером пакетов (npm)

- Добавлена опция --compare-npm, которая:

- вызывает npm ls --json

- извлекает порядок зависимостей, который строит npm

- сравнивает его с результатом собственной программы

- выводит различия:

   - пакеты, которые есть только у нас

   - пакеты, которые есть только у npm

   - различия в позициях

- Причины возможных расхождений также выводятся (npm использует собственную стратегию nested node_modules).

### Использование

``` bash
cd stage4
```
### Тестовый режим
``` bash
python stage4.py --package A --url test_complex.txt --mode test --load-order --ascii
```

### Пример вывода:
```
Direct dependencies of A: ['B', 'C', 'D']


ASCII dependency tree:
└── A    
    ├── B    
    ├── C   
    └── D

NPM-style load order:
1. A
2. D
3. H


Topological order (Kahn):
1. A
2. B
3. C
```

### Реальный режим

Получение данных напрямую из https://registry.npmjs.org
:
``` bash
python stage4.py --package react --version 18.2.0 --url https://registry.npmjs.org --mode real --load-order --ascii
```

Пример вывода:
```
Direct dependencies of react@18.2.0:
  - loose-envify: ^1.1.0

ASCII dependency tree:
└── react
    └── loose-envify
        └── js-tokens

NPM-style load order:
1. react
2. loose-envify
3. js-tokens

Topological order (Kahn):
1. react
2. loose-envify
3. js-tokens
```
### Сравнение с реальным npm

Для выполнения этой функции должен быть установлен Node.js и npm.

Команда:
``` bash
python stage4.py --package react --version 18.2.0 --url https://registry.npmjs.org --mode real --compare-npm
```


Если npm даст другой порядок, программа выведет анализ:

- расхождения в списке пакетов
- расхождения в позициях
- пояснение причин (версии, peer deps, layout node_modules)
